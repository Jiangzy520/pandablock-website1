<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>手机端聊天窗口测试 - 强制刷新版本</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    
    h1 {
      color: #333;
      margin-bottom: 20px;
      font-size: 24px;
    }
    
    .status {
      background: #f0f9ff;
      border-left: 4px solid #0ea5e9;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 4px;
    }
    
    .status h2 {
      color: #0369a1;
      font-size: 18px;
      margin-bottom: 10px;
    }
    
    .status ul {
      margin-left: 20px;
      color: #0c4a6e;
    }
    
    .status li {
      margin: 8px 0;
    }
    
    .test-section {
      background: #fef3c7;
      border-left: 4px solid #f59e0b;
      padding: 15px;
      margin: 20px 0;
      border-radius: 4px;
    }
    
    .test-section h3 {
      color: #92400e;
      margin-bottom: 10px;
    }
    
    .test-section ol {
      margin-left: 20px;
      color: #78350f;
    }
    
    .test-section li {
      margin: 8px 0;
    }
    
    .success {
      background: #dcfce7;
      border-left: 4px solid #22c55e;
      padding: 15px;
      margin: 20px 0;
      border-radius: 4px;
      color: #166534;
    }
    
    .error {
      background: #fee2e2;
      border-left: 4px solid #ef4444;
      padding: 15px;
      margin: 20px 0;
      border-radius: 4px;
      color: #991b1b;
    }
    
    .code {
      background: #1e293b;
      color: #e2e8f0;
      padding: 15px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      overflow-x: auto;
      margin: 15px 0;
    }
    
    .version-info {
      background: #f1f5f9;
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
    }
    
    .version-info strong {
      color: #4CAF50;
      font-size: 18px;
    }
    
    .floating-toolbar {
      position: fixed;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      background: white;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .floating-toolbar button {
      display: block;
      width: 50px;
      height: 50px;
      margin: 10px 0;
      border: none;
      border-radius: 8px;
      font-size: 24px;
      cursor: pointer;
      background: #f0f0f0;
      transition: all 0.3s;
    }
    
    .floating-toolbar button:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>🐼 PandaBlock 手机端聊天窗口测试</h1>
    
    <div class="version-info">
      <strong>当前版本：v3.0.6</strong><br>
      <small>修复：手机端聊天窗口自动打开和显示问题</small><br>
      <small>时间戳：<?php echo time(); ?></small>
    </div>
    
    <div class="status">
      <h2>✅ 已修复的问题</h2>
      <ul>
        <li><strong>问题1：</strong>聊天窗口在手机上自动打开 → <strong>已修复</strong></li>
        <li><strong>问题2：</strong>聊天窗口显示不完整，超出屏幕 → <strong>已修复</strong></li>
        <li><strong>问题3：</strong>聊天窗口没有居中 → <strong>已修复</strong></li>
      </ul>
    </div>
    
    <div class="test-section">
      <h3>📱 测试步骤</h3>
      <ol>
        <li><strong>页面加载时：</strong>
          <ul>
            <li>✅ 只显示左下角的绿色聊天按钮（🐼）</li>
            <li>✅ 聊天窗口应该是隐藏的</li>
            <li>✅ 右侧浮动工具栏正常显示（⚡💰🔧）</li>
          </ul>
        </li>
        <li><strong>点击聊天按钮后：</strong>
          <ul>
            <li>✅ 聊天窗口从底部弹出</li>
            <li>✅ 窗口居中显示，左右各有10px边距</li>
            <li>✅ 窗口高度为屏幕高度的70%</li>
            <li>✅ 可以看到完整的聊天界面</li>
          </ul>
        </li>
        <li><strong>检查聊天窗口内容：</strong>
          <ul>
            <li>✅ 头部显示"PandaBlock AI"和关闭按钮</li>
            <li>✅ 欢迎消息完整显示</li>
            <li>✅ 三个快捷回复按钮文字清晰（深色）</li>
            <li>✅ 输入框和发送按钮正常显示</li>
          </ul>
        </li>
        <li><strong>测试滚动：</strong>
          <ul>
            <li>✅ 消息区域可以正常滚动</li>
            <li>✅ 滚动流畅，没有卡顿</li>
          </ul>
        </li>
        <li><strong>点击关闭按钮（×）：</strong>
          <ul>
            <li>✅ 聊天窗口关闭</li>
            <li>✅ 只显示聊天按钮</li>
          </ul>
        </li>
      </ol>
    </div>
    
    <div class="success">
      <strong>🎯 预期效果：</strong><br>
      页面加载时，聊天窗口默认隐藏，只显示左下角的聊天按钮。<br>
      点击按钮后，聊天窗口居中弹出，完整显示所有内容。
    </div>
    
    <div class="code">
      <strong>技术实现：</strong><br>
      • 使用 CSS: display: none 默认隐藏窗口<br>
      • 使用 .pb-show class 控制显示/隐藏<br>
      • 手机端宽度: calc(100vw - 20px)<br>
      • 手机端高度: 70vh<br>
      • 定位: left: 10px, right: 10px, margin: 0 auto
    </div>
    
    <div class="error" id="error-section" style="display: none;">
      <strong>❌ 如果仍然有问题：</strong><br>
      1. 强制刷新页面（Ctrl+Shift+R 或 Cmd+Shift+R）<br>
      2. 清除浏览器缓存<br>
      3. 在隐私模式/无痕模式下打开<br>
      4. 检查浏览器控制台是否有错误
    </div>
  </div>
  
  <!-- 模拟右侧浮动工具栏 -->
  <div class="floating-toolbar">
    <button title="快速开发">⚡</button>
    <button title="价格咨询">💰</button>
    <button title="服务介绍">🔧</button>
  </div>
  
  <!-- 加载聊天组件 - 使用时间戳强制刷新 -->
  <script src="simple-chat-widget.js?v=3.0.6&t=<?php echo time(); ?>" defer></script>
  
  <script>
    // 检测聊天组件是否正确加载
    window.addEventListener('load', () => {
      setTimeout(() => {
        const chatWidget = document.getElementById('pandablock-chat-widget');
        const chatWindow = document.getElementById('pb-chat-window');
        const chatButton = document.getElementById('pb-chat-button');
        
        if (!chatWidget || !chatWindow || !chatButton) {
          document.getElementById('error-section').style.display = 'block';
          console.error('❌ 聊天组件加载失败');
          return;
        }
        
        // 检查聊天窗口是否默认隐藏
        const windowDisplay = window.getComputedStyle(chatWindow).display;
        const hasShowClass = chatWindow.classList.contains('pb-show');
        
        console.log('✅ 聊天组件加载成功');
        console.log('聊天窗口 display:', windowDisplay);
        console.log('聊天窗口 pb-show class:', hasShowClass);
        
        if (windowDisplay !== 'none' && !hasShowClass) {
          console.warn('⚠️ 警告：聊天窗口可能没有正确隐藏');
          document.getElementById('error-section').style.display = 'block';
        }
      }, 1500);
    });
  </script>
</body>
</html>

